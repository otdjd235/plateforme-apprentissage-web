{% extends "nav.html" %}

{% block title %}Profile - My Website{% endblock %}

{% block content %}
    <div class="container">
        <div class="sidebar">
            <a class="active" href="{{ url_for('profile') }}" id="profile-tab">&#128100 Profile</a>
            <a href="#" id="favorites-tab">&#x1F4DA Vos Cours</a>
            <a href="#" id="setting-tab">&#9881 Profile Settings</a>
        </div>

        <div class="section" id="profile-section">
            <div class="card small">
                <img src="https://cdn-icons-png.flaticon.com/512/9706/9706583.png" width="300" height="300" margin="auto">
                <div class="username">{{ user.username }}</div>
                <div>{{ user.role }}</div>
            </div>
            <div class="card large">
                <div style="font-size: 24px; padding-bottom: 10px; font-weight: bold;">Account Information</div>
                <div class="profile-info">Username: {{ user.username }}</div>
                <div class="profile-info">Email: {{ user.email }}</div>
                <div class="profile-info">Phone Number: {{ user.tel }}</div>
                <div class="profile-info">Date of Birth: {{ user.date_naissance }}</div>
            </div>
        </div>

        <div class="section" id="favorite-section" style="display:none;">
            <div class="course-grid">
            {% for cours in cours_suivi %}
                <div class="course-card">
                    <a href="/cours/${{ cours.id_cours }}" class="course-link">
                        <div class="course-content">
                            <strong> {{ cours.nom_cours }}</strong>
                            <p> {{ cours.description_courte }} </p>
                            <span class="discipline">Discipline : {{cours.id_domaine}} </span>
                            <span class="duration">Dur√©e : {{cours.duree_totale}} minutes</span>
                            <div class="favorite-container">
                                <button class="favorite-btn" data-id="${course.id_cours}">&#9733;</button>
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}
            </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const tabs = {
            "profile-tab": "profile-section",
            "favorites-tab": "favorite-section"
        };

        Object.keys(tabs).forEach(tabId => {
            document.getElementById(tabId).addEventListener("click",  function(e) {
                e.preventDefault();

                Object.values(tabs).forEach(sectionId => {
                    document.getElementById(sectionId).style.display = "none";
                });

                document.getElementById(tabs[tabId]).style.display = "block"

                document.querySelectorAll(".sidebar a").forEach(link => link.classList.remove("active"));
                this.classList.add("active");

            });
        });
        addFavoriteButtonListeners();
    });

    function addFavoriteButtonListeners() {
                document.querySelectorAll(".favorite-btn").forEach(button => {
                    button.addEventListener("click", function() {
                        event.stopPropagation();

                        const isFavorited = this.classList.toggle("favorited")

                        if(isFavorited){
                            //adding course to suivre
                            fetch('/suivre', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify( { id_cours: this.dataset.id })
                            })
                        } else {
                            fetch(`/suivre/${this.dataset.id}`, {
                                method: 'DELETE',
                            });
                        }
                    });
                });
            }
    </script>


{% endblock %}