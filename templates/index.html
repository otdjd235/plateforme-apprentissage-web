{% extends "nav.html" %}

{% block title %}Home - GLO-2005{% endblock %}

{% block content %}
    <div class="container1">
        <h1>Liste des Cours</h1>

        <div class="filters">
            <input type="text" id="search" placeholder="Rechercher un cours...">
            
            <select id="filter-discipline">
                <option value="">Toutes les disciplines</option>
                <option value="1">Mathématiques</option>
                <option value="2">Informatique</option>
                <option value="3">Réseaux</option>
                <option value="4">Sécurité</option>
                <option value="5">Bases de données</option>
            </select>

            <select id="sort-duration">
                <option value="">Trier par durée</option>
                <option value="asc">Durée croissante</option>
                <option value="desc">Durée décroissante</option>
            </select>
        </div>

        <div class="courses">
            <div class="course-grid" id="course-list">
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const courseListElement = document.getElementById("course-list");
            const searchInput = document.getElementById("search");
            const filterDiscipline = document.getElementById("filter-discipline");
            const sortDuration = document.getElementById("sort-duration");

            let coursesData = [];

            function fetchCourses() {
                fetch("/api/cours?page=1&cours_per_page=10")
                    .then(response => response.json())
                    .then(data => {
                        coursesData = data.data;
                        displayCourses();
                    })
                    .catch(error => console.error("Erreur lors de la récupération des cours:", error));
            }

            function displayCourses() {
                courseListElement.innerHTML = "";

                let filteredCourses = coursesData.filter(course => {
                    const searchText = searchInput.value.toLowerCase();
                    const disciplineFilter = filterDiscipline.value;
                    
                    const matchesSearch = course.nom_cours.toLowerCase().includes(searchText);

                    const matchesDiscipline = disciplineFilter === "" || course.id_domaine == disciplineFilter;

                    return matchesSearch && matchesDiscipline;
                });

                if (sortDuration.value === "asc") {
                    filteredCourses.sort((a, b) => a.duree_totale - b.duree_totale);
                } else if (sortDuration.value === "desc") {
                    filteredCourses.sort((a, b) => b.duree_totale - a.duree_totale);
                }

                filteredCourses.forEach(course => {
                    const courseCard = document.createElement('div');
                    courseCard.classList.add('course-card');

                    courseCard.innerHTML = `
                        <div class="course-content">
                            <strong>${course.nom_cours}</strong>
                            <p>${course.description_courte}</p>
                            <span class="discipline">Discipline : ${course.id_domaine}</span>
                            <span class="duration">Durée : ${course.duree_totale} minutes</span>
                            <div class="favorite-container">
                                <button class="favorite-btn" data-id="${course.id_cours}">&#9733;</button>
                            </div>
                        </div>
                    `;

                    courseListElement.appendChild(courseCard);
                });

                addFavoriteButtonListeners();
            }

            function addFavoriteButtonListeners() {
                document.querySelectorAll(".favorite-btn").forEach(button => {
                    button.addEventListener("click", function() {
                        this.classList.toggle("favorited");
                    });
                });
            }

            searchInput.addEventListener("input", displayCourses);
            filterDiscipline.addEventListener("change", displayCourses);
            sortDuration.addEventListener("change", displayCourses);

            fetchCourses();
        });
    </script>

{% endblock %}
